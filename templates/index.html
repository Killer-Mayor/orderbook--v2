{% extends "base.html" %}
{% block title %}New Order{% endblock %}

{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h4 class="mb-3">Create Order</h4>

    <form method="post" action="/submit">
      <div class="mb-3">
        <label class="form-label">Company</label>
        <input name="company" list="companies" class="form-control" required>
        <datalist id="companies">
          {% for c in companies %}<option value="{{ c }}">{% endfor %}
        </datalist>
      </div>

      <table class="table table-bordered">
        <thead class="table-light">
          <tr>
            <th>Product</th>
            <th>Brand</th>
            <th width="120">Qty</th>
            <th width="140">Price</th>
            <th width="80"></th>
          </tr>
        </thead>
        <tbody id="rows">
          <tr>
            <td><input name="orders[0][product]" list="products" class="form-control" required></td>
            <td><input name="orders[0][brand]" list="brands" class="form-control"></td>
            <td><input name="orders[0][quantity]" type="number" min="1" class="form-control" required></td>
            <td><input name="orders[0][price]" type="number" step="0.01" class="form-control" required></td>
            <td><button type="button" class="btn btn-danger btn-sm remove">✕</button></td>
          </tr>
        </tbody>
      </table>

      <button type="button" class="btn btn-secondary mb-3" id="addRow">+ Add Item</button>

      <datalist id="products">
        {% for p in products %}<option value="{{ p }}">{% endfor %}
      </datalist>

      <datalist id="brands">
        {% for b in brands %}<option value="{{ b }}">{% endfor %}
      </datalist>

      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" name="includes_gst">
        <label class="form-check-label">Prices include GST (5%)</label>
      </div>

      <button class="btn btn-primary">Submit Order</button>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let idx = 1;
document.getElementById('addRow').onclick = () => {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input name="orders[${idx}][product]" list="products" class="form-control" required></td>
    <td><input name="orders[${idx}][brand]" list="brands" class="form-control"></td>
    <td><input name="orders[${idx}][quantity]" type="number" class="form-control" required></td>
    <td><input name="orders[${idx}][price]" type="number" step="0.01" class="form-control" required></td>
    <td><button type="button" class="btn btn-danger btn-sm remove">✕</button></td>
  `;
  document.getElementById('rows').appendChild(tr);
  idx++;
};

document.addEventListener('click', e => {
  if (e.target.classList.contains('remove')) {
    e.target.closest('tr').remove();
  }
});
</script>
{% endblock %}
